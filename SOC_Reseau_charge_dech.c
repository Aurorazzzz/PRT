#include "SOC_Aurore.h"

#define max(a,b) ((a) > (b) ? (a) : (b))
#define min(a,b) ((a) < (b) ? (a) : (b))

void setup() {


 const float *courant;
 const float *tension;
 const float *temperature;
 const float *SOH;
 const float *SOC_simu;

 Charge_donnees(&courant, &tension, &temperature, &SOH, &SOC_simu);

  // dimension du LSTM
  const int tailleEntree = 3;
  const int tailleReseau = 20;
  const int tailleSortie = 1;

  // entrées & états
//  float courant = 3;
//  float tension = 3.05;
//  float temperature = 35;
//  float SOH = 1;
  float SOC = 0;

// Aurore : taille des tableaux enlever. Inutile si la taille ne change pas et cause des erreurs

// Aurore : Pourquoi xt est initialisé ?

float xt[] = {9.4559 , 4.2866 , -13.2461 };
float ht[] = {
    0.3798397,
    0.3062328,
   -0.6554675,
    0.3987524,
    0.0289980,
   -0.5341352,
   -0.3869888,
   -0.2985158,
   -0.0073859,
    0.1701567,
    0.4621694,
   -0.4317311,
   -0.3938790,
    0.3820191,
   -0.3776624,
   -0.1662854,
   -0.2701407,
   -0.2550447,
   -0.5868483,
   -0.4139786
};

float ct[] = {
    1.0188674,
    0.8454764,
   -5.1968155,
    1.1536393,
    0.0602404,
   -2.7788281,
   -1.2268720,
   -0.5622150,
   -0.0168389,
    0.3993067,
    1.6457914,
   -2.1349487,
   -1.4351975,
    1.0316762,
   -1.0116690,
   -0.3754922,
   -0.5788238,
   -0.5681386,
   -2.2419636,
   -1.2073565
};

const float Wi[] = {
-0.0013864826, -0.0062211026, 0.028899601,
-0.034216348, 0.016249107, 0.0082352981,
-0.017262992, -0.026258819, -0.021888761,
0.026080182, -0.033874288, -0.027821528,
0.013705736, -0.019075816, -0.0081324875,
-0.11093795, 0.047589920, 0.040971465,
0.010036851, -0.029377056, 0.012180340,
-0.062342536, 0.027823940, -0.063649774,
0.056758422, -0.020777594, -0.058653843,
-0.0011184115, 0.010122604, 0.0077513885,
-0.025817389, 0.0069514485, -0.00050656381,
0.062905341, -0.060380209, 0.013519747,
-0.029200895, 0.046324968, -0.077246420,
0.076306075, -0.0035868469, 0.027114836,
0.036865570, -0.0069207884, -0.057449546,
-0.058017172, 0.019747764, 0.00081198639,
0.017188998, -0.028647775, 0.011704437,
0.0027979510, -0.0093269739, -0.0015458546,
-0.021795042, -0.045927200, 0.050816488,
0.0048363949, -0.028298687, -0.0078725629
};
const float Wf[] = {
-0.00069749152, -0.0067451010, 0.042119496,
-0.051892355, 0.073635213, 0.019345636,
0.093462564, -0.22773984, 0.0043599787,
0.041617222, -0.083448254, -0.00056920771,
0.0058238031, -0.023986697, -0.012499326,
0.073594868, -0.064767897, -0.010122155,
0.026360201, -0.042808671, 0.022931857,
-0.10084403, 0.00023575520, -0.058728464,
0.095830768, -0.034385771, -0.13739407,
0.032066874, 0.0066194003, 0.022114808,
-0.027390294, 0.0073501850, -0.0030258500,
0.095409028, -0.11319499, 0.013430123,
0.023161361, 0.13742582, -0.16714025,
0.068584681, 0.063569821, -0.063962750,
-0.056474775, 0.16839598, -0.035132650,
-0.10801778, 0.0096693952, 0.0044863992,
0.052297529, -0.060808938, 0.023972575,
0.0023848475, -0.010931749, -0.0014465256,
0.0047543701, -0.12055064, 0.12040976,
0.053391077, -0.066283815, 0.00022211130
};
const float Wo[] = {
0.0062894998, 0.011053815, 0.024437066,
-0.0043050181, 0.057281226, 0.00022245033,
0.029564664, -0.11464067, -0.011823306,
-0.035573807, -0.011592723, -0.030806517,
0.012449744, -0.017784340, -0.013152497,
0.023304399, -0.029480074, 0.0036827496,
-0.021535497, 0.038481198, -0.014154078,
-0.066149779, -0.072418801, -0.060781460,
-0.0028373697, 0.056257986, -0.043182481,
-0.00020178517, 0.0099809747, 0.013117602,
-0.024832005, 0.013203118, -0.0032107276,
0.025593486, 0.065962650, 0.022633363,
0.0012594154, 0.079197697, -0.079808928,
0.059904739, -0.011413852, 0.083101146,
-0.047692824, 0.029802987, 0.026927549,
-0.059390135, 0.030146772, -0.013046196,
0.010435775, -0.025734659, 0.012452380,
-0.00080738403, -0.0080266949, -0.00056450104,
-0.050869063, -0.017681850, 0.056015737,
0.027054112, -0.019066591, -0.028817946
};
const float Wg[] = {
-0.049626015, -0.093100652, -0.037031494,
0.042571083, -0.17520042, 0.035962202,
0.19468853, 0.24414109, -0.022398207,
0.14523810, -0.16808611, 0.033612859,
0.034259718, -0.054838713, -0.074051328,
0.23345011, 0.29670644, 0.020186439,
-0.0063582072, 0.092913039, -0.10280504,
-0.19163576, 0.13546452, -0.010702923,
-0.20457338, 0.045475908, -0.11771677,
0.051694527, -0.087863266, -0.043911561,
-0.14638656, -0.26578858, -0.015354945,
-0.054293551, 0.16972937, 0.027203158,
0.20220429, 0.42485970, -0.012865260,
0.040131185, -0.18734632, 0.15097469,
0.13374907, 0.27371734, 0.068452150,
0.11753921, 0.00062358158, 0.099930525,
0.064181745, 0.086205572, -0.035361923,
0.065173753, 0.094111241, 0.022045940,
0.035333410, 0.032521646, -0.026796810,
0.00016427721, 0.099141642, -0.051770873
};
const float Ri[] =  {
-0.00012863369, 0.0027692916, -0.0044937194, 0.0011528181, -0.0019124795, -0.0044157607, -0.0027408504, -0.0054475549, -0.00081712601, -0.00083135208, 0.0039905249, -0.0017602188, -0.0068715536, 0.0078524612, -0.0028607992, 0.0010374580, -0.0018764377, -2.6624839e-05, -0.0011081693, -0.0014840225,
-0.0014417989, -0.0014910116, 0.0035644670, 0.00065510545, -0.0012519797, -0.0027054125, 0.0044282093, -0.0017971731, 0.0027536119, -0.0036399472, -0.0021356321, 0.0063118637, 0.0065193288, -0.00088195095, 0.0038860731, 0.0017975939, -0.0025569811, -0.0012217602, 0.0052412366, 0.0042586480,
-0.0035761427, 0.0034230023, 0.022145221, -0.0024125187, 0.0042107007, 0.038931593, 0.0037307155, -0.021178631, -0.016290234, -0.00076581485, 0.0025848900, 0.0092527149, 0.021694992, -0.0020298122, 0.0067597311, 0.0070583872, -0.0029174441, -0.00093710952, -0.026149986, 0.0043108058,
-0.0049895123, 0.0072067874, 0.048700105, 0.024926916, 0.0037776486, 0.010254627, -0.0030079661, -0.038194414, -0.025045775, 0.0063220300, -0.0015693698, -0.017427145, 0.016353531, -0.011932581, 0.024998644, 0.0065775099, 0.014223574, 0.0020303284, 0.039294817, -0.0085557867,
0.00044174993, 0.0022172036, -0.0025697052, 0.0017123558, 0.0019612217, -0.0032286420, 0.0019946776, -0.0033637756, 0.0020643149, 0.00035962724, 0.0016328697, 0.00037723052, -0.0044623222, 0.0039471244, -0.0041973731, 0.00087960379, -0.0015353989, -0.0013003600, -0.0017694861, 0.0013067492,
-0.0039773630, -0.023700438, -0.014382360, -0.059459582, -0.0065674069, 0.063759141, -0.00084391615, -0.055990737, -0.016131319, -0.0027432325, -0.0043601613, 0.016972028, 0.028361121, -0.020609161, 0.036203127, -0.013388256, 0.0022536577, -0.0017686164, -0.0081215575, -0.00091145880,
0.0030275369, 0.0070631807, -0.0051987618, 0.0061880276, 0.0030890275, -0.0061379843, -0.0026227275, -0.020860601, -0.0022546570, 0.0021655580, 0.0095219025, -0.0077866632, -0.011828206, 0.0076167937, -0.0078465063, 0.00037480696, -0.0027350835, -0.0028519910, -0.0030349281, -0.0026867699,
-0.0010662861, -0.010350823, 0.025265910, -0.010343112, -0.0040928936, 0.0015348168, -0.0092065409, -0.0019734295, -0.015395002, 0.0046889535, 0.0019189731, -0.014156268, 0.025517924, -0.025200862, 0.028284939, -0.012571394, 0.015247320, 0.0037322748, 0.033000965, -0.012840605,
-0.0060016266, 0.016265126, 0.025421798, 0.032211803, 0.010124647, -0.016327834, 0.0016966270, -0.076498397, -0.028872630, 0.0045672641, 0.0088416860, -0.019526437, -0.0023013172, 0.0088633746, 0.0080512613, 0.015572054, 0.0074619236, -0.0016836355, 0.038090523, -0.0024070807,
-0.0012311311, 0.0019265102, 0.00081848999, 0.00080913870, 0.00070143002, -0.00012272882, 0.00049116323, -2.1961881e-05, 0.0016968576, -0.00068004878, 0.00062450080, 0.00099338801, -0.0059451764, 0.0053234738, -0.0034703889, 0.0022687251, -0.00069796242, 0.00047047221, -0.00084482296, 0.0014409473,
0.0017261097, -0.00057153340, -0.0041719195, -0.0030020531, -0.00071555935, 0.0015315384, 0.00086642004, -0.0055513196, 0.0010701488, -0.0010329885, 0.0017341346, 0.0013662896, -0.00086043158, -0.0016830222, -0.0015206113, -0.0010531629, -0.0019468744, -0.0014739194, -0.0031070972, 0.0013683947,
0.00098105741, 0.013493042, 0.014857101, 0.022751577, 0.0024964949, -0.021122970, -0.012350958, -0.051634002, -0.020141928, 0.0059636626, 0.012214613, -0.025099481, -0.017247213, 0.011777036, 0.0026157415, 0.0068765390, 0.0051238453, -0.00065801787, 0.024332630, -0.013103696,
0.0039314693, -0.0076014153, -0.0032934248, -0.0027074653, -0.0026970259, 0.022355286, 0.0014085703, 0.015107334, -0.0079116309, -0.0011563455, -0.012419472, -0.0066532344, 0.027768910, -0.032224298, 0.015492565, -0.0076557375, 0.0029528388, -2.4867164e-05, -0.0092492690, 0.0011338009,
0.0034711875, -0.0043389215, -0.0035795330, -0.0021900844, -0.0028663832, 0.020109298, 0.00072250678, 0.022198966, 0.0065307706, -0.0041965214, -0.0093403067, 0.0050274641, 0.033917692, -0.018446103, 0.0079993652, -0.0010209749, -0.0046210159, -0.00079016690, -0.017142417, 0.0029819252,
-0.011189041, -0.010181429, 0.037442036, 0.0028134962, 0.010803851, 0.052666031, 0.0026606992, -0.028827360, -0.011787190, -0.0019563430, -0.013868585, 0.0065557719, 0.017179167, -0.0092304489, 0.025415264, 0.0079639964, 0.0048894524, 0.00033856535, 0.038391635, 0.0053766714,
0.00094378262, -0.0050207325, -0.010297783, -0.010923705, -0.0050353319, -0.0085591776, 0.0043869764, 0.010464478, 0.013907663, -0.0081491806, 0.0027820589, 0.011177462, -0.0027020096, 0.0013837967, -0.0011139594, -0.0057920218, -0.0045651933, -0.0026485857, 0.0022652568, 0.0055969087,
-0.0033473696, 0.0048463987, 0.0051611559, 0.0057678097, 0.0039373995, 0.0054611545, 0.0014820449, -0.0048066922, 0.0023323470, 4.4923483e-05, -0.00029215097, 0.00063877110, -0.0072110738, 0.0075985915, -0.0045817723, 0.0049075470, -0.0016932117, -0.00066527264, 8.4593514e-05, 0.0015063054,
-4.2428248e-05, 0.00081951922, -0.00047650890, -0.00033813945, 0.0011036912, -0.00050809520, 0.0010852878, -0.0012073459, 0.0013694089, -4.1855059e-05, 0.00044041217, 0.0012208454, -0.0021920779, 0.0021113772, -0.0020957037, 0.00055872521, -0.00094292709, -0.00077322434, -0.00088953675, 0.00092490262,
-0.0045504649, 0.016705967, 0.0010111145, 0.021306466, -0.0020481406, -0.041678891, -0.012564369, -0.013446745, -0.0015581949, -0.0010961829, 0.015955640, -0.021016650, -0.042147994, 0.026130056, -0.014935778, 0.0037452974, -0.0013813544, -0.0012636899, -0.0063467058, -0.0092650931,
0.0032517607, 0.0059382427, -0.0067368387, 0.0056481427, 0.0052320077, -0.0066635194, -0.00071528769, -0.017432433, -0.00054962392, 0.0026222176, 0.0092592202, -0.0062327539, -0.011593383, 0.0074766087, -0.0097407829, 0.00090058777, -0.0031627400, -0.0030613001, -0.0069391900, -0.0013560004
};
const float Rf[] = {
-0.00013011342,0.0048455270,-0.0074222190,0.0016901849,-0.0032575256,-0.0076536704,-0.0047379592,-0.0086479532,-0.0021392123,-0.0010636818,0.0056937924,-0.0036672249,-0.010824581,0.012489458,-0.0041990280,0.0020666351,-0.0024744421,5.5707227e-05,-0.0023389212,-0.0028195460,
-0.0025852779,-0.0015319104,0.0044031269,0.0020847346,-0.0013927233,-0.0037012859,0.0049364250,-0.0050781672,0.0023721580,-0.0051076142,-0.0027248506,0.0076137865,0.0090600094,-7.4266791e-06,0.0062171421,0.0041335723,-0.0032811398,-0.0014089107,0.0096562561,0.0049595400,
-0.00040015572,0.032940205,0.077125423,0.067546889,-0.0046611167,0.0012141897,-0.069636755,-0.18650217,-0.14475116,0.026264286,0.025856767,-0.10687159,-0.0079819188,0.017116392,0.074299917,0.015912822,0.050332118,0.0085625127,0.089131549,-0.067206308,
-0.0081693120,0.018311627,0.083683416,0.051397230,0.0028444687,0.0071604331,-0.017920587,-0.077086449,-0.054641355,0.012658539,0.00066767615,-0.042789537,0.022911357,-0.015038487,0.047299020,0.015614255,0.028757080,0.0052147168,0.084237881,-0.025055811,
0.0019032178,0.0031813174,-0.0062985192,0.0021866404,0.0032953364,-0.0068076868,0.0025211577,-0.0053728861,0.0036427095,0.00046655140,0.0033127915,0.00065770617,-0.0069843810,0.0062628780,-0.0069732019,0.0011144984,-0.0031156105,-0.0024557281,-0.0037142839,0.0017785068,
-0.0033030428,-0.031982489,0.0095202262,-0.066230804,-0.017866816,0.086950026,-0.047520641,-0.18105605,-0.10100859,0.017997483,-0.0037649614,-0.043173671,0.071253881,-0.034763411,0.11437836,-0.022540998,0.042660490,0.0076452484,0.063577756,-0.047632340,
0.0041410998,0.010411417,-0.0095403716,0.010854922,0.0041941777,-0.0083231973,-0.0034662145,-0.029600304,-0.0028767339,0.0028908402,0.013110414,-0.010630270,-0.018006776,0.011759205,-0.011973916,0.0016258071,-0.0042371145,-0.0038022452,-0.0070208022,-0.0033238388,
-0.0018140021,-0.014786881,0.057465330,-0.0093682585,-0.011962168,-0.010610756,-0.026169827,-0.037177511,-0.042841982,0.0098171197,0.0092979297,-0.037907105,0.039973348,-0.041049771,0.061260249,-0.021912392,0.033052046,0.0081213638,0.087561540,-0.031615637,
-0.013125248,0.021421339,0.086985752,0.050792638,0.011799294,-0.0059335944,-0.0030742052,-0.13860063,-0.068265311,0.0098465979,0.011281111,-0.044497263,0.0091778869,-0.0067210379,0.041888714,0.018810509,0.033483043,0.0046352483,0.088434927,-0.011835586,
-0.0021119770,0.0033587278,0.00099546625,0.0017568872,6.0588536e-06,-0.00085264986,-0.00026109588,-0.0011892618,0.0014098784,-0.00079971255,0.00060841389,3.6100566e-05,-0.0089822486,0.0078342315,-0.0042600571,0.0034458018,-0.00019596124,0.0011185728,-0.0010269583,0.00095554098,
0.0025286688,-0.00064600800,-0.0074891155,-0.0037045658,-0.0011211921,6.9114118e-05,-0.00050755899,-0.011565876,-0.00083975453,-0.00077911263,0.0034971833,-0.00047583901,-0.0022669975,-0.0018667793,-0.0017399658,-0.0020598292,-0.0027768763,-0.0024331582,-0.0051421872,0.00015520932,
0.0011941426,0.022442114,0.031078009,0.039545409,0.0047900216,-0.020608591,-0.021294449,-0.080312423,-0.035228141,0.011478686,0.018051663,-0.042436499,-0.024355531,0.013972943,0.011469400,0.010104766,0.011760676,0.00095683389,0.029708076,-0.023169396,
0.0036258306,-0.025470037,0.0018512253,-0.0083007151,0.0014046106,0.041840561,0.011880392,0.030887954,-0.0078631938,6.4465181e-05,-0.023745224,-0.0079753939,0.050998855,-0.066753738,0.030213870,-0.021443056,0.0060013589,0.00063010590,-0.022890447,0.010478642,
0.0062360205,-0.0057453108,-0.0033495622,0.0023345610,0.0011388644,0.029767197,0.0021007345,0.020251734,0.0044508418,-0.0045568640,-0.015697118,0.0038558526,0.050286356,-0.026352415,0.013094118,0.0030532989,-0.0072339131,-0.0026675942,-0.022114445,0.0046941116,
-0.016766867,-0.017156539,0.058919877,0.014611074,0.013349478,0.065022841,-0.0019539592,-0.066610828,-0.028273940,0.00010944691,-0.011556266,0.0060596010,0.022083499,-0.0061244788,0.041942250,0.0072846184,0.012043394,0.010959642,0.064076610,0.0032238353,
0.0030959533,-0.0041644173,-0.013125503,-0.010692610,-0.0044141901,-0.014224891,0.0027428062,0.0082355877,0.014360895,-0.0088601690,0.0057822764,0.010308176,-0.0032045348,0.0023612152,-0.0024737194,-0.0077738506,-0.0068035969,-0.0048641232,0.0064509232,0.0039265128,
-0.0036786946,0.0090918923,0.011824469,0.012479026,0.0066914372,0.0067194612,-0.0016794691,-0.013682886,-0.0026643591,0.0022352957,0.0017725836,-0.0052708685,-0.012304722,0.012568688,-0.0040886016,0.0078468667,0.00067846040,-0.00063893991,0.0089560989,-0.0025423549,
0.00024130920,0.0013336189,-0.00090648007,1.5999951e-05,0.0016537928,-0.0012090636,0.0012247592,-0.0023648955,0.0015588903,0.00014467606,0.0010589104,0.0011421394,-0.0033660561,0.0031492172,-0.0029594069,0.00075363554,-0.0013991911,-0.0012287616,-0.0012723301,0.00089108763,
0.00026454037,0.033475872,-0.0010327236,0.047316313,-0.013108255,-0.098955832,-0.049839914,-0.071101874,-0.043582849,0.0043957913,0.036884069,-0.071152993,-0.079300091,0.049132898,0.0026990019,0.0055051260,0.014625607,0.0026547725,0.023357347,-0.041258357,
0.0045965407,0.0086163860,-0.011370906,0.0090974271,0.0069654812,-0.010249758,-0.0021041674,-0.024717730,-0.0021838946,0.0042153578,0.013749855,-0.0097823348,-0.018726140,0.013271928,-0.014162353,0.0021469155,-0.0039359932,-0.0039765923,-0.013985183,-0.0029344831
};
const float Ro[] = {
-0.0030283097, 0.00083971757, -0.0010231412, -0.0019410893, -0.0023691114, -0.0012173493, 0.00015107600, -0.0016560210, 0.0018125257, -0.0023916552, 0.00076044723, 0.0014402147, -0.0048992094, 0.0053677652, -0.00092121953, 0.00099573261, -0.00020699702, 0.0017335298, 0.0024394733, 0.0017170291,
-0.00065495993, -0.0067485920, -0.00044316699, -0.00091731898, -1.1308931e-05, -0.0020467963, 0.0065334355, -0.0025864965, 0.0065001091, -0.0045284620, -0.0014162557, 0.0086960318, 0.0053277784, -0.00083942397, 0.0029044517, 0.00095085427, -0.0043742736, -0.0037916796, 0.0044642622, 0.0062134443,
-0.0016409400, 0.014579475, 0.026948240, 0.010911780, 0.0086300327, 0.011099619, -0.020733943, -0.069231801, -0.043938417, 0.0091112023, 0.016138541, -0.028225031, -0.027169768, 0.034476928, 0.0091926875, 0.0067948904, 0.012727393, 0.00029196404, 0.020964412, -0.019929161,
0.0018028371, -0.0043464275, 0.011335298, 0.0016778186, -0.0032836024, -0.0014542089, 0.0056856801, -0.025995377, -0.0064603309, -0.0026676147, -0.00027183205, 0.0033311117, 0.024807589, -0.018424977, 0.016350197, -0.0034930925, 0.00043402758, -0.0051546218, 0.028216068, 0.0017068160,
0.00060142990, 0.0026014764, -0.0022990122, 0.0026530337, 0.0028404538, -0.0031113527, 0.0023591986, -0.0047171200, 0.0023887379, 0.00055073260, 0.0018475219, 0.00020772390, -0.0050568762, 0.0042103389, -0.0049131317, 0.0010386674, -0.0015964295, -0.0015482581, -0.0014325397, 0.0015160503,
-0.011267896, -0.0083276806, 0.023900047, -0.027771410, -0.00070569885, 0.097315334, -0.010371089, -0.059821144, -0.028785381, 0.0063374327, -0.011801784, 0.00066927052, 0.029433252, -0.018753368, 0.048347075, -0.00088636368, 0.016603457, 0.0043103839, 0.0077350959, -0.012048366,
-0.0017963774, 0.0043383390, 0.0051711798, 0.0036265168, 0.0074780406, 0.0014623883, 0.0078131659, -0.015361586, 0.0040801079, 0.0010782216, 0.0036943974, 1.5909871e-05, -0.0052775010, 3.8695347e-05, -0.011156314, 0.0024039280, -0.0020991990, -0.00028196606, -0.014857809, 0.0077850390,
-0.0019943661, -0.0057406523, 0.035140045, -0.0067832181, 0.0042687948, 0.0020839819, -0.0078660361, -0.058884121, -0.031709913, 0.0089250663, 0.013221256, -0.022252955, 0.017318686, -0.014747381, 0.029678034, -0.011152980, 0.018428467, 0.0026983221, 0.067556024, -0.016030278,
-0.0086932266, 0.016579177, 0.039972972, 0.026807543, 0.020459604, -0.0049927020, 0.0064910892, -0.061866716, -0.017680801, 0.0051200874, 0.0085709086, -0.017048832, 0.0040233410, 0.012231683, 0.0029016598, 0.020339211, 0.010784870, 0.00088347081, 0.022629254, 0.0074103153,
-0.0018374241, 0.0019998397, 0.0026257595, 0.0010203184, 0.00067915133, 3.0700816e-05, 0.00080285710, 0.00042675057, 0.0019938301, -0.0010177271, 6.1057857e-05, 0.0011304617, -0.0058594765, 0.0054089995, -0.0033643972, 0.0027573351, -0.00011480274, 0.00095065054, -0.00055292191, 0.0018506825,
0.0021366791, -0.00036478008, -0.0051297485, -0.0034313824, -0.00089424854, -0.00032747068, 0.00095839956, -0.0059551937, 0.0021574362, -0.0014912130, 0.0026358201, 0.0013142948, -0.0025060354, -0.0010225979, -0.0027434465, -0.0014482375, -0.0021421879, -0.0017122946, -0.0036194085, 0.0018246665,
-0.0038306704, 0.0092222244, 0.011767847, 0.012413288, 0.0012800924, -0.0089362562, -0.0022844947, -0.045249786, -0.014468975, 0.0018052506, 0.0044248840, -0.015057669, 0.0057503907, -0.0039831037, -6.6105044e-05, 0.0089471331, 0.0013620961, 0.0034269122, -0.013080765, 0.00014751509,
-0.0023366204, -0.0094896778, -0.00066027086, 0.0016781591, 0.0036791638, 0.026994571, 0.013307679, 0.021643713, 0.0056873956, -0.0082593318, -0.027292430, 0.0095203016, 0.074614070, -0.049742375, 0.041856434, 0.00078211009, -0.0019265777, -0.0016001647, 0.0099579776, 0.013053825,
0.00087762886, 0.0044657793, -0.019250423, 0.0046809148, -0.0022215559, 0.0095836483, 0.0081860172, 0.0037533115, 0.021836812, -0.015224237, -0.0085696289, 0.020078374, 0.013432563, 0.0039880527, 0.0037648755, 0.010276834, -0.018949736, -0.0079628248, -0.0043135220, 0.013432193,
-0.0064667813, 0.0056488835, 0.028049940, 0.013417775, 0.017772721, 0.028187634, 0.012823273, -0.075383149, -0.0041966224, -0.0020045380, -0.00072217890, 0.0069329226, 0.022886740, 0.0013532954, 0.0042859148, 0.010689393, -0.0082277013, -0.0074620661, 0.044016927, 0.013932972,
-4.2433880e-05, -0.0078062485, -0.011551313, -0.015898490, -0.0052707409, -0.0058983793, 0.0061158249, 0.012786795, 0.016982740, -0.0091944886, 0.0015678252, 0.013684698, -0.0020085606, -0.0014331847, -0.0013176787, -0.0094061941, -0.0042342199, -0.0026614752, 0.0053761154, 0.0073032426,
-0.0018777862, 0.0050293761, 0.0037245706, 0.0060980846, 0.0042579942, 0.0039747627, 0.0010932555, -0.0054332493, 0.0026143643, 2.4733614e-05, 0.0011217473, 0.00019278211, -0.0086103566, 0.0079858098, -0.0058611729, 0.0044948072, -0.0023616680, -0.0012747897, 0.0017846569, 0.0012046658,
0.00026432096, 0.00099899515, -0.00091204752, -7.2973140e-05, 0.0011132669, -0.0010960184, 0.00086111418, -0.0013713604, 0.0012989145, 1.2738321e-05, 0.00094671577, 0.00091194996, -0.0025614861, 0.0023893046, -0.0023741554, 0.00051479565, -0.0011918028, -0.00096708222, -0.0013374302, 0.00070573762,
-0.0062707602, 0.012739182, 0.00083586626, 0.019094633, -0.0050306860, -0.032825850, -0.013108574, -0.018739507, -0.0049243104, -0.0034279530, 0.013678038, -0.021284735, -0.029902993, 0.012756335, -0.0062106233, 0.0028535170, -0.00044884719, 0.00079806859, -0.0020168652, -0.0084657148,
-0.0033467785, 0.0049619167, 0.0079916101, 0.0014878107, 0.0062553021, -0.00065737928, 0.0070717758, -0.0096206060, 0.0053749136, -4.2644460e-05, 0.0036200883, 0.00099403132, -0.0081380196, 0.0037111340, -0.010301675, 0.0035518997, -0.00070521893, 0.0011245455, -0.020584496, 0.0081805773
};
const float Rg[] = {
0.011380021, -0.0076471027, -0.057373099, 0.0018569209, 0.036166023, -0.067983121, 0.042048085, 0.0026364161, 0.032967780, 0.0049870643, -0.00075210293, -0.013881245, 0.083111562, 0.015770158, -0.022219039, 0.067516603, -0.026020152, -0.032585297, -0.10064702, -0.00098966155,
0.0091631468, 0.053782843, 0.0088534039, 0.0035992516, -0.046829876, -0.024001060, -0.040872429, 0.071942784, -0.042707678, 0.021585420, -0.019274326, -0.050990064, -0.053171802, -0.020393847, 0.011388199, 0.0049052276, -0.0037808202, 0.015324997, -0.022959040, -0.046371713,
-0.032339513, 0.068455286, 0.16213232, 0.11140841, 0.041161302, 0.19471937, 0.073271893, -0.077747233, -0.15017238, -0.0081984363, -0.0077594961, -0.015299243, -0.037643798, -0.076197557, 0.039038360, 0.083308518, -0.027518459, -0.039542444, 0.090741038, 0.053218026,
-0.012474012, 0.074704997, 0.040216811, 0.086092867, 0.026405260, 0.0022596247, -0.031727601, 0.059534531, 0.022074766, 0.038721550, 0.0098689087, -0.052618589, -0.097151011, -0.014926859, 0.014745064, -0.025510516, 0.071750410, 0.026223399, 0.057336926, -0.045729201,
0.010435553, -0.016673198, -0.0016979445, -0.014251636, -0.014746844, 0.010700826, -0.018266365, 0.043840140, -0.0083313864, 0.0039915461, -0.010791022, -0.0017540732, -0.0058370908, -0.023258803, 0.0021283487, -0.018173393, 0.0061106514, 0.0026620878, -3.8976228e-05, -0.012807283,
-0.049648806, -0.036341682, 0.22150542, -0.10211045, 0.022653960, 0.34481642, 0.11171334, -0.047870588, 0.054342296, 0.033005215, -0.11740378, 0.22781940, -0.10861293, 0.026611404, 0.083136082, 0.032723565, -0.016880883, 0.047014594, -0.14658472, 0.051736217,
0.0059154909, 0.043485075, 0.054553211, -0.0057710158, 0.019657958, 0.053124003, 0.011535557, 0.0047982484, -0.016424559, 0.013046485, -0.027934857, 0.019568831, -0.0032599750, -0.031134607, -0.046488460, 0.035480190, 0.00095849403, 0.016242450, -0.026456477, 0.0089284219,
0.042038672, -0.10244892, -0.19350846, -0.074750729, 0.013861524, 0.047908649, 0.025899097, 0.31443536, 0.15935573, -0.024414610, -0.019878816, 0.091769889, 0.025845429, -0.016117623, -0.099020787, -0.13681407, -0.054677147, 0.0072581363, -0.23606677, 0.025604011,
0.034832336, 0.028368801, -0.10606067, -0.087680243, 0.031841092, -0.019666245, -0.011439027, 0.12021317, 0.019895475, 0.014978723, -0.033755653, 0.055701677, -0.033960637, 0.034858409, -0.11324300, -0.0041714297, -0.037602399, -0.10836002, -0.11089345, -0.038283762,
-0.0017924216, -0.051016051, -0.0012823817, -0.012828777, -0.0014165641, 0.015719490, 0.056600872, -0.011731427, 0.023622917, -0.014904043, -0.0056601767, 0.0029709814, -0.0076633641, 0.0096839443, 0.013251672, -0.00048090256, -0.0049398327, 0.026677940, -0.033219919, 0.028207688,
0.0029775782, -0.019901995, -0.062011916, -0.036209453, -0.047038291, -0.058799051, -0.026917228, 0.018996807, 0.032707591, 0.044023398, 0.010723946, -0.042657759, -7.2567404e-05, -0.034121111, -0.0018726934, -0.071870774, -0.018080544, 0.014113349, 0.017888913, -0.053015731,
-0.00063317007, 0.041734543, 0.037877642, -0.062969975, 0.0062408983, 0.14510898, 0.031920832, 0.015553083, -0.038323954, 0.0039526774, -0.067354977, 0.027771577, 0.054283731, -0.019261751, -0.080789849, 0.0014694647, -0.016892144, 0.040019594, -0.061282516, 0.056992333,
-0.040675238, 0.029724300, 0.031566016, -0.046916582, -0.060629360, 0.083252378, 0.065658838, -0.15506327, -0.058288161, -0.095279597, -0.083250515, 0.063517392, 0.27589291, -0.027384138, 0.18966955, 0.094735563, -0.055617169, -0.057425324, 0.057460614, 0.10987768,
0.046728332, 0.069671616, -0.086762659, -0.046242334, -0.0037840365, -0.19232121, -0.047606815, 0.050405785, -0.013088485, -0.017400984, 0.0030571825, 0.022226198, -0.15526727, 0.050965976, -0.044424992, -0.026305124, -0.083354592, -0.0062056612, -0.012223706, -0.059222557,
-0.050714362, -0.087660447, 0.17418277, 0.10149908, 0.040196326, 0.080170058, -0.063756719, -0.18630482, -0.095007598, -0.019137394, -0.016409444, -0.0067173727, 0.093945108, -0.089253247, 0.11860599, 0.034035888, 0.10853296, 0.047996577, 0.082626402, -0.022221455,
0.012758578, 0.12850147, 0.044905592, -0.0022423514, -0.0022394368, 0.037959740, -0.039082773, -0.0093874196, -0.017974632, 0.017352076, -0.046052828, -0.0050457069, -0.013023458, -0.015033426, -0.012193600, -0.010935254, 0.046064582, -0.00070401235, 0.069426335, -0.022047356,
-0.018208077, 0.039263573, 0.059202962, 0.054216761, 0.044328149, 0.047612760, 0.016281921, -0.076268330, -0.0071433196, 0.0018752601, 0.021120561, -0.00081227918, -0.022881994, 0.041659988, -0.0027815057, 0.014883485, 0.0066398084, -0.0050668223, 0.047053404, 0.0051542833,
-0.0043593273, 0.036620896, 0.038778409, 0.018017778, 0.016765164, 0.030475399, 0.011887835, -0.0039333203, -0.0058862851, -0.0037679097, 0.0062187803, 0.024277667, -0.033645693, 0.026393350, -0.027974917, 0.019689914, -0.010865174, -0.0059646005, 0.013869387, 0.014094235,
-0.074829005, 0.023750937, 0.20493120, 0.061911955, 0.016788382, -0.030423740, 0.028251573, -0.18486090, -0.069425359, 0.0065596742, -0.018809961, 0.0030675014, 0.065685861, -0.011795996, 0.11332884, 0.029331448, 0.035522267, 0.011620028, 0.20640336, -0.0074124164,
-0.0077722026, -0.040219191, 0.021014808, -0.010595121, -0.018159725, 0.046873692, 0.013981400, 0.0030005698, -0.040423136, 0.015015917, -0.055709273, 0.037048083, -0.029684797, -0.010327034, -0.053503305, 0.041133750, 0.0042143981, 0.026673958, -0.053679388, -0.0078335330
};
const float bi[] = {
0.021830671,
0.0052007609,
-0.19646758,
0.12656313,
0.027032696,
0.056662641,
0.00010464549,
0.31578395,
-0.036964480,
-0.20359045,
0.063695639,
0.042350065,
0.28482649,
0.052687403,
0.065264441,
-0.10739913,
-0.096291833,
-0.093407489,
-0.082689203,
-0.051337820
};
const float bf[] = {
1.0726818,
1.0037237,
1.6866307,
1.1731848,
1.0175271,
1.5895159,
1.0257015,
1.4534626,
1.1115949,
0.88629502,
1.0568575,
1.1113257,
1.2747149,
1.0784068,
1.0901393,
0.92537093,
1.0510730,
0.93836868,
1.6208851,
0.98094755
};
const float bo[] = {
0.012126683,
-0.0072340751,
0.21882717,
-0.076534554,
-0.13331288,
0.17910515,
-0.053714626,
0.095586002,
-0.033561181,
-0.17692156,
0.0074879476,
-0.00044262066,
0.19100501,
-0.024096480,
0.079000905,
-0.077230476,
-0.022440026,
-0.049876448,
0.20572019,
-0.067651227
}; 
const float bg[] =  {
0.037613917,
-0.062977239,
-0.014873940,
-0.052555870,
-0.091550730,
0.056742482,
-0.15600424,
0.025524646,
-0.19160326,
0.074789889,
-0.042407811,
-0.13508618,
0.066211224,
-0.15954833,
0.13687727,
-0.093114950,
0.12518466,
0.073838428,
0.047759991,
-0.15311302
};
const float WFC[] = {
0.12609875, -0.068089060, 0.0053611528, -0.18885078, -0.062905803, 0.079015225, -0.22830738, 0.099312805, -0.29774314, 0.090282865, -0.018683480, -0.26478145, 0.41183549, -0.39351287, 0.33447424, -0.28329730, 0.085165799, 0.022279553, 0.036187608, -0.27151808
};
const float bFC = {0.21451218};
const float MOY[] = {
-0.10627028,
3.3187597,
28.803194};
const float ECART_TYPE[] = {
4.1876230,
0.20175342,
2.2353570};
  // variables intermédiaires : pas d'initialisation
  float it[tailleReseau];
  float ft[tailleReseau];
  float gt[tailleReseau];
  float ot[tailleReseau];


  // Aurore : Les tableaux sont des const float, donc les pointeurs aussi (rajout du const)
  // Aurore : enlever les {} qui entouraient les pointeurs
  // définition des pointeurs
  float *pointeur_ht = &ht[0];
  float *pointeur_ct = &ct[0];
  float *pointeur_xt = &xt[0];
  float *pointeur_it = &it[0];
  float *pointeur_ft = &ft[0];
  float *pointeur_gt = &gt[0];
  float *pointeur_ot = &ot[0];
  const float *pointeur_Wi =  &Wi[0];
  const float *pointeur_Wf =  &Wf[0];
  const float *pointeur_Wg =  &Wg[0];
  const float *pointeur_Wo =  &Wo[0];
  const float *pointeur_Ri =  &Ri[0];
  const float *pointeur_Rf =  &Rf[0];
  const float *pointeur_Rg =  &Rg[0];
  const float *pointeur_Ro =  &Ro[0];
  const float *pointeur_bi =  &bi[0];
  const float *pointeur_bf =  &bf[0];
  const float *pointeur_bg = &bg[0];
  const float *pointeur_bo = &bo[0];
  const float *pointeur_WFC =  &WFC[0] ;
  const float *pointeur_bFC =  &bFC ;
  const float *pointeur_MOY =  &MOY[0] ;
  const float *pointeur_ECART_TYPE = &ECART_TYPE[0];

  // vecteurs intermédiaires
  float vect_intermediaire_1[tailleReseau];
  float *pointeur_vect_intermediaire_1 =  &vect_intermediaire_1[0] ;
  float vect_intermediaire_2[tailleReseau];
  float *pointeur_vect_intermediaire_2 =  &vect_intermediaire_2[0] ;

  // variables de sortie
  float sortie_LSTM;
  float *pointeur_sortie_LSTM =  &sortie_LSTM ;

  // filtre de Kalman
  const float dt = 1;
  const float moins_eta_sur_Q = 0.00023003;
  float Pk = 1;
  float *pointeur_Pk =  &Pk; 
  float *pointeur_SOC =  &SOC ; 
  const float Qk = 0.000001;
  const float Rk = 1;
  // Fk et Hk ne sont pas définies car elles valent 1 et sont multiplicatives

  // mesure de temps
  unsigned long tempsInitial;
  unsigned long tempsFinal;
  float bilanTempsLSTM;
  float bilanTempsFdK;
  const int NbIteration = 1000;
  int z;

  // initialisation de la communication pour les résultats
  // Serial.begin(9600);
  printf("");
  printf("");

  // simulation
  // Aurore : Mesure du temps de simulation, a régler plus tard
  // tempsInitial = micros();
  for (z = 0; z <= NbIteration - 1; z++) {
    estimationSOC(-courant[z], tension[z], temperature[z], SOH[z], moins_eta_sur_Q, pointeur_Pk, pointeur_SOC,
                    dt, Qk, Rk, tailleEntree, tailleReseau, tailleSortie, pointeur_sortie_LSTM,
                   pointeur_xt, pointeur_ct, pointeur_ht,
                   pointeur_it, pointeur_ft, pointeur_gt, pointeur_ot,
                   pointeur_Wi, pointeur_Wf, pointeur_Wg, pointeur_Wo,
                   pointeur_Ri, pointeur_Rf, pointeur_Rg, pointeur_Ro,
                   pointeur_bi, pointeur_bf, pointeur_bg, pointeur_bo,
                   pointeur_MOY, pointeur_ECART_TYPE, pointeur_WFC, pointeur_bFC,
                   pointeur_vect_intermediaire_1, pointeur_vect_intermediaire_2);

  
    printf("%f\n", *(pointeur_SOC));
  }
  // Aurore : A regler plus tard
  //tempsFinal = micros();
 // bilanTempsLSTM = (tempsFinal - tempsInitial) / NbIteration;

  // affichage des résultats
  printf("Sortie : ");
  printf("%f\n", *(pointeur_SOC) *1000);
  //printf("Bilan (ms) : ");
  //printf(bilanTempsLSTM / 1000);
  printf("");

  Free_donnees(courant, tension, temperature, SOH, SOC_simu);
}

// Aurore : fonction loop inutile
// void loop() {
//   // put your main code here, to run repeatedly:
// }

void estimationSOC(float courant, float tension, float temperature, float SOH, const float moins_eta_sur_Q, float *pointeur_Pk, float *pointeur_SOC,
                   const float dt, const float Qk, const float Rk, int tailleEntree, int tailleReseau, int tailleSortie, float *pointeur_sortie_LSTM,
                   float *pointeur_xt, float *pointeur_ct, float *pointeur_ht,
                   float *pointeur_it, float *pointeur_ft, float *pointeur_gt, float *pointeur_ot,
                   const float *pointeur_Wi,const float *pointeur_Wf,const float *pointeur_Wg,const float *pointeur_Wo,
                   const float *pointeur_Ri,const float *pointeur_Rf,const float *pointeur_Rg,const float *pointeur_Ro,
                   const float *pointeur_bi,const float *pointeur_bf,const float *pointeur_bg,const float *pointeur_bo,
                   const float *pointeur_MOY,const float *pointeur_ECART_TYPE,const float *pointeur_WFC,const float *pointeur_bFC,
                   float *pointeur_vect_intermediaire_1, float *pointeur_vect_intermediaire_2) {

float Sk;
float Kk;
  float residus;
  float prediction_LSTM;
  float SOC = *pointeur_SOC;
  SOC = SOC - moins_eta_sur_Q * dt * courant / SOH;
  *(pointeur_xt) = courant;
  *(pointeur_xt + 1) = tension;
  *(pointeur_xt + 2) = temperature;

  predictionLSTM(tailleEntree, tailleReseau, tailleSortie, pointeur_sortie_LSTM, pointeur_xt, pointeur_ct, pointeur_ht,
                 pointeur_it, pointeur_ft, pointeur_gt, pointeur_ot,
                 pointeur_Wi, pointeur_Wf, pointeur_Wg, pointeur_Wo,
                 pointeur_Ri, pointeur_Rf, pointeur_Rg, pointeur_Ro,
                 pointeur_bi, pointeur_bf, pointeur_bg, pointeur_bo,
                 pointeur_MOY, pointeur_ECART_TYPE, pointeur_WFC, pointeur_bFC,
                 pointeur_vect_intermediaire_1, pointeur_vect_intermediaire_2);
  prediction_LSTM = *pointeur_sortie_LSTM;
  prediction_LSTM = min(max(prediction_LSTM, 0), 1);
  *(pointeur_Pk) = *(pointeur_Pk) + Qk;  // on néglige Fk = 1
  residus = prediction_LSTM - SOC;
  Sk = *(pointeur_Pk) + Rk;  // on néglige Hk = 1;
  Kk = *(pointeur_Pk) / Sk;
  SOC = SOC + Kk * residus;
  SOC = min(max(SOC, 0), 1);
  *(pointeur_Pk) = (1 - Kk) * *(pointeur_Pk);
  *(pointeur_SOC) = SOC;
}

void predictionLSTM(int tailleEntree, int tailleReseau, int tailleSortie, float *pointeur_sortie_LSTM, float *pointeur_xt, float *pointeur_ct, float *pointeur_ht,
                    float *pointeur_it, float *pointeur_ft, float *pointeur_gt, float *pointeur_ot,
                    const float *pointeur_Wi,const float *pointeur_Wf,const float *pointeur_Wg,const float *pointeur_Wo,
                    const float *pointeur_Ri,const float *pointeur_Rf,const float *pointeur_Rg,const float *pointeur_Ro,
                    const float *pointeur_bi,const float *pointeur_bf,const float *pointeur_bg,const float *pointeur_bo,
                    const float *pointeur_MOY,const float *pointeur_ECART_TYPE,const float *pointeur_WFC,const float *pointeur_bFC,
                    float *pointeur_vect_intermediaire_1, float *pointeur_vect_intermediaire_2) {


  int i;

  // mise en forme de l'entrée
  for (i = 0; i <= tailleEntree - 1; i++) {
    *(pointeur_xt + i) = (*(pointeur_xt + i) - *(pointeur_MOY + i)) / *(pointeur_ECART_TYPE + i);
  }

  // calcul de it
  MatriceFoisVecteur(tailleReseau, tailleEntree, pointeur_Wi, pointeur_xt, pointeur_vect_intermediaire_1);
  MatriceFoisVecteur(tailleReseau, tailleReseau, pointeur_Ri, pointeur_ht, pointeur_vect_intermediaire_2);
  for (i = 0; i <= tailleReseau - 1; i++) {
    *(pointeur_it + i) = *(pointeur_vect_intermediaire_1 + i) + *(pointeur_vect_intermediaire_2 + i) + *(pointeur_bi + i);
  }
  sigma_g_sigmoide(tailleReseau, pointeur_it, pointeur_it);

  // calcul de ft
  MatriceFoisVecteur(tailleReseau, tailleEntree, pointeur_Wf, pointeur_xt, pointeur_vect_intermediaire_1);
  MatriceFoisVecteur(tailleReseau, tailleReseau, pointeur_Rf, pointeur_ht, pointeur_vect_intermediaire_2);
  for (i = 0; i <= tailleReseau - 1; i++) {
    *(pointeur_ft + i) = *(pointeur_vect_intermediaire_1 + i) + *(pointeur_vect_intermediaire_2 + i) + *(pointeur_bf + i);
  }
  sigma_g_sigmoide(tailleReseau, pointeur_ft, pointeur_ft);

  // calcul de gt
  MatriceFoisVecteur(tailleReseau, tailleEntree, pointeur_Wg, pointeur_xt, pointeur_vect_intermediaire_1);
  MatriceFoisVecteur(tailleReseau, tailleReseau, pointeur_Rg, pointeur_ht, pointeur_vect_intermediaire_2);
  for (i = 0; i <= tailleReseau - 1; i++) {
    *(pointeur_gt + i) = *(pointeur_vect_intermediaire_1 + i) + *(pointeur_vect_intermediaire_2 + i) + *(pointeur_bg + i);
  }
  sigma_c_tanh(tailleReseau, pointeur_gt, pointeur_gt);

  // calcul de ot
  MatriceFoisVecteur(tailleReseau, tailleEntree, pointeur_Wo, pointeur_xt, pointeur_vect_intermediaire_1);
  MatriceFoisVecteur(tailleReseau, tailleReseau, pointeur_Ro, pointeur_ht, pointeur_vect_intermediaire_2);
  for (i = 0; i <= tailleReseau - 1; i++) {
    *(pointeur_ot + i) = *(pointeur_vect_intermediaire_1 + i) + *(pointeur_vect_intermediaire_2 + i) + *(pointeur_bo + i);
  }
  sigma_g_sigmoide(tailleReseau, pointeur_ot, pointeur_ot);

  // calcul de ct
  for (i = 0; i <= tailleReseau - 1; i++) {
    *(pointeur_ct + i) = *(pointeur_ft + i) * *(pointeur_ct + i) + *(pointeur_it + i) * *(pointeur_gt + i);
  }

  // calcul de ht
  sigma_c_tanh(tailleReseau, pointeur_ct, pointeur_ht);
  for (i = 0; i <= tailleReseau - 1; i++) {
    *(pointeur_ht + i) = *(pointeur_ot + i) * *(pointeur_ht + i);
  }

  // calcul de la sortie
  MatriceFoisVecteur(tailleSortie, tailleReseau, pointeur_WFC, pointeur_ht, pointeur_vect_intermediaire_1);
  *(pointeur_sortie_LSTM) = *(pointeur_vect_intermediaire_1) + *pointeur_bFC;
}

void sigma_g_sigmoide(int x_size, float *pointeur_entree, float *pointeur_sortie_sig) {

  int i;

  for (i = 0; i <= x_size - 1; i++) {
    *(pointeur_sortie_sig + i) = 1 / (1 + exp(-*(pointeur_entree + i)));
  }
}

void sigma_c_tanh(int x_size, float *pointeur_entree, float *pointeur_sortie_tanh) {

  int i;

  for (i = 0; i <= x_size - 1; i++) {
    *(pointeur_sortie_tanh + i) = tanh(*(pointeur_entree + i));
  }
}


void MatriceFoisVecteur(int nbLignesMatrice, int tailleVecteur, const float *pointeur_matrice, float *pointeur_vecteur, float *pointeur_sortie_prodMat) {
  // définition des variables
  int i;
  int j;
  float resultat_tmp;


  for (i = 0; i <= nbLignesMatrice - 1; i++) {
    resultat_tmp = 0;
    for (j = 0; j <= tailleVecteur - 1; j++) {
      resultat_tmp += *(pointeur_matrice + j + i * tailleVecteur) * *(pointeur_vecteur + j);
    }
    *(pointeur_sortie_prodMat + i) = resultat_tmp;
  }

}

void Charge_donnees ( float **courant,  float **tension,  float **temperature,  float **SOH, float **SOC) {
    char *fichiers[] = {"courant.bin", "tension.bin", "temperature.bin",  "SOH.bin", "SOC.bin"};
    float **donnees[] = { courant, tension, temperature, SOH, SOC };
    int nFichiers = 5;
    
    size_t N = 4841577; // nombre d'éléments dans ton fichier

    for(int k = 0; k < nFichiers; k++) {
        *donnees[k] = malloc(N * sizeof(float));
        if(*donnees[k] == NULL) {
            printf("Erreur allocation mémoire\n");
            // ici, tu pourrais libérer ce qui a déjà été alloué
            return;
        }
    }

    for(int k = 0; k < nFichiers; k++) {
    // Si besoin, tu peux construire un chemin complet
    char chemin[256];
    snprintf(chemin, sizeof(chemin), "../donnees/%s", fichiers[k]); // dossier "donnees"
    printf(chemin);
    
    FILE *fp;
    // Ouverture du fichier binaire
    fp = fopen(chemin, "rb"); // rb = read binary
    if(fp == NULL) {
        printf("Erreur ouverture fichier !\n");
        // Donner contient les adresses des pointeurs, je veux modifier l'adresse pointer par le pointeur, donc dereferencement
        free(*donnees[k]);
        return 1;
    }

    // Lecture des données dans le vecteur
    size_t nbLu = fread(*donnees[k], sizeof(float), N, fp);
    if(nbLu != N) {
        printf("Erreur lecture fichier : lu %zu éléments au lieu de %zu\n", nbLu, N);
    }

    fclose(fp);

    printf("Premier : %f\n", (*donnees[k])[0]);
    printf("Dernier : %f\n", (*donnees[k])[N-1]);
    }
}

void Free_donnees ( float *courant,  float *tension,  float *temperature,  float *SOH,  float *SOC) {
    free(courant);
    free(tension);
    free(temperature);
    free(SOH);
    free(SOC);
}

// Aurore : Rajout du main, sinon ça fonctionne pas

int main() {
    setup();
    printf("Fin du programme\n");
}